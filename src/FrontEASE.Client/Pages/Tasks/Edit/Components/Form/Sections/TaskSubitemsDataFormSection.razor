@inject IResourceHandler resourceHandler

@{
    var connectorOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.LLM_CONNECTOR).ToList();
    var evaluatorOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.EVALUATOR).ToList();
    var solutionOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.SOLUTION).ToList();

    var stoppingConditionOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.STOPPING_CONDITION).ToList();
    var testsOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.TEST).ToList();
    var analysesOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.ANALYSIS).ToList();
    var statOptions = TaskModalContext.Task.Config.AvailableModules.Where(x => x.PackageType == ModuleType.STATISTIC).ToList();
}


<TaskConfigDataFormSection TaskModalContext="TaskModalContext" />

<TaskModuleDataFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
    TaskModalContext.Task.Config.Solution,
    solutionOptions,
    resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Solution), PropertyDisplayResourceType.FIELD))))" />

<TaskModuleDataFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
    TaskModalContext.Task.Config.Connector,
    connectorOptions,
    resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Connector), PropertyDisplayResourceType.FIELD))))" />

<TaskModuleDataFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
    TaskModalContext.Task.Config.Evaluator,
    evaluatorOptions,
    resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Evaluator), PropertyDisplayResourceType.FIELD))))" />


<TaskModuleDataItemFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
        new TaskModuleDto(),
        stoppingConditionOptions,
        resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.StoppingConditions), PropertyDisplayResourceType.FIELD))))"
    Modules="TaskModalContext.Task.Config.StoppingConditions" />

<TaskModuleDataItemFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
        new TaskModuleDto(),
        testsOptions,
        resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Tests), PropertyDisplayResourceType.FIELD))))"
    Modules="TaskModalContext.Task.Config.Tests" />

<TaskModuleDataItemFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
        new TaskModuleDto(),
        analysesOptions,
        resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Analyses), PropertyDisplayResourceType.FIELD))))"
    Modules="TaskModalContext.Task.Config.Analyses" />

<TaskModuleDataItemFormSection TaskModalContext="TaskModalContext" TaskModuleContext="@(new TaskModuleContext(
        new TaskModuleDto(),
        statOptions,
        resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskConfigDto>(nameof(TaskConfigDto.Stats), PropertyDisplayResourceType.FIELD))))"
    Modules="TaskModalContext.Task.Config.Stats" />

@if (TaskModalContext.Task.Author.Id == PageContext.LoggedInUser.Id || PageContext.LoggedInUser.Role == UserRole.OWNER)
{
    <TaskAccessSubitemsDataFormSection TaskModalContext="TaskModalContext" />
}


@code {
    [CascadingParameter]
    public TasksPageContext PageContext { get; set; } = null!;

    [Parameter]
    public TaskModalContext TaskModalContext { get; set; } = null!;
}