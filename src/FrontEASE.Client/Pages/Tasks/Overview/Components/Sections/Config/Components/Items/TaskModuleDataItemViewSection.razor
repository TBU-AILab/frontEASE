@inject IResourceHandler resourceHandler

<Row>
    <Container Fluid>
        <Row>
            <Column ColumnSize="ColumnSize.IsFull">
                <Div Display="Display.Flex">
                    <Column ColumnSize="ColumnSize.Is12" TextAlignment="TextAlignment.Center" Class="align-self-center">
                        <FormSectionHeader DisplayText="@TaskModuleContext.ModuleName" />
                    </Column>
                </Div>
            </Column>
        </Row>
    </Container>

    <Divider Class="divider-section bg-custom-light" Shadow="Shadow.Small" />

    <Column ColumnSize="ColumnSize.Is12" Padding="Padding.Is3.FromTop">
        <Container Fluid>
            @if (Modules.Count > 0)
            {
                @foreach (var module in Modules)
                {
                    <Fields Class="form-group">

                        <Column ColumnSize="@(string.IsNullOrWhiteSpace(TaskModuleContext.ModuleData?.Description) ? ColumnSize.IsFull : ColumnSize.Is10.OnWidescreen)" Margin="Margin.Is2.FromTop.Is2.FromBottom">
                            <Text>
                                @(resourceHandler.GetResource(AttributeExtensions.GetResourceFieldValue<TaskModuleDto>(nameof(TaskModuleDto.ShortName), PropertyDisplayResourceType.FIELD)))
                            </Text>
                            <Span TextWeight="TextWeight.Bold" Class="fst-italic">
                                @($" {TaskModuleContext.ModuleData?.LongName ?? module.ShortName}")
                            </Span>
                        </Column>

                        @if (!string.IsNullOrWhiteSpace(TaskModuleContext.ModuleData?.Description))
                        {
                            <Field ColumnSize="ColumnSize.Is2.OnWidescreen" TextAlignment="TextAlignment.Center" Class="align-self-center" Padding="Padding.Is0.FromEnd.Is0.FromStart" Margin="Margin.Is2.FromTop">
                                <Div>
                                    @if (!string.IsNullOrWhiteSpace(TaskModuleContext.ModuleData?.Description))
                                    {
                                        <Tooltip Multiline="true" Text="@(TaskModuleContext.ModuleData?.Description)" Display="Display.InlineBlock" Padding="Padding.Is1.FromEnd">
                                            <Icon Class="action-icon-sm action-icon-info" Name="IconName.InfoCircle" IconSize="IconSize.Default" IconStyle="IconStyle.Solid" />
                                        </Tooltip>
                                    }
                                </Div>
                            </Field>
                        }

                    </Fields>

                    @if (!string.IsNullOrWhiteSpace(module.ShortName))
                    {
                        var moduleOptions = TaskModuleContext.ModuleOptions.Where(x => x.ShortName == module.ShortName).ToList();
                        var moduleContext = new TaskModuleContext(module, moduleOptions, TaskModuleContext.ModuleName);
                        if (moduleOptions is not null)
                        {
                            <TaskModuleParamsViewSection TaskModalContext="TaskModalContext" TaskModuleContext="moduleContext" />
                        }
                        else
                        {
                            Console.WriteLine($"Module not found - {module.ShortName}");
                        }
                    }
                }
            }
            else
            {
                <Div>
                    <Text Class="text-custom-primary">
                        @(resourceHandler.GetResource($"{UIConstants.Data}.{UIConstants.Error}.{HttpStatusCode.NotFound}.{nameof(TaskConfigDto)}.{CollectionName}.{UIElementConstants.Collection}"))
                    </Text>
                </Div>
            }
        </Container>
    </Column>
</Row>

@code {
    [Parameter]
    public TaskModalContext TaskModalContext { get; set; } = null!;

    [Parameter]
    public TaskModuleContext TaskModuleContext { get; set; } = null!;

    [Parameter]
    public IList<TaskModuleDto> Modules { get; set; } = [];

    [Parameter]
    public string CollectionName { get; set; } = string.Empty;
}
